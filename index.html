<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ficha Completa com Esperança e Medo</title>
  <style>
    :root {
      --primary: #2ecc71;
      --primary-dark: #27ae60;
      --secondary: #ff6a00;
      --secondary-dark: #e55d00;
      --purple: #8e44ad;
      --gold: #f7dc6f;
      --dark-bg: #121212;
      --darker-bg: #0e0e0e;
      --card-bg: #1e1e1e;
      --input-bg: #2c2c2c;
      --text-light: #f0f0f0;
      --text-muted: #bbb;
    }

    @font-face {
      font-family: 'Poppins';
      src: url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
    }

    body {
      background: linear-gradient(135deg, var(--dark-bg), var(--darker-bg));
      color: var(--text-light);
      font-family: 'Poppins', 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      line-height: 1.6;
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 20px;
    }

    h1 {
      text-align: center;
      font-size: 2.5rem;
      color: var(--primary);
      text-shadow: 0 0 15px rgba(46, 204, 113, 0.5);
      margin: 30px 0;
      font-weight: 700;
      letter-spacing: 1px;
      position: relative;
      padding-bottom: 15px;
    }

    h1::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 150px;
      height: 3px;
      background: linear-gradient(90deg, transparent, var(--primary), transparent);
      border-radius: 3px;
    }

    .section {
      background: var(--card-bg);
      border: 1px solid #333;
      border-radius: 16px;
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .section:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 25px rgba(0, 0, 0, 0.4);
    }

    .section h2 {
      font-size: 1.4rem;
      margin-bottom: 20px;
      color: var(--primary);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section h2::before {
      content: '';
      display: inline-block;
      width: 8px;
      height: 25px;
      background: var(--primary);
      border-radius: 4px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--text-light);
    }

    input[type="text"],
    input[type="number"],
    textarea {
      width: 100%;
      padding: 12px 15px;
      border-radius: 10px;
      border: 2px solid transparent;
      background: var(--input-bg);
      color: white;
      margin-bottom: 20px;
      font-size: 1rem;
      resize: vertical;
      transition: all 0.3s ease;
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    input[type="text"]:focus,
    input[type="number"]:focus,
    textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.2);
    }

    .atributos-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
    }

    .checkbox-group {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .checkbox-group label {
      display: flex;
      align-items: center;
      gap: 8px;
      background: var(--input-bg);
      padding: 10px 15px;
      border-radius: 8px;
      cursor: pointer;
      user-select: none;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .checkbox-group label::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      width: 3px;
      height: 100%;
      background: var(--primary);
      transition: width 0.3s ease;
    }

    .checkbox-group label:hover {
      background: #3a3a3a;
      transform: translateY(-2px);
    }

    .checkbox-group label:hover::before {
      width: 6px;
    }

    .checkbox-group input[type="checkbox"] {
      cursor: pointer;
      width: 18px;
      height: 18px;
      accent-color: var(--primary);
    }

    #rollBtn {
      display: block;
      margin: 40px auto;
      padding: 16px 40px;
      font-size: 1.2rem;
      font-weight: 600;
      color: white;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      border: none;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(46, 204, 113, 0.4);
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      z-index: 1;
    }

    #rollBtn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: 0.5s;
      z-index: -1;
    }

    #rollBtn:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 25px rgba(39, 174, 96, 0.6);
    }

    #rollBtn:hover::before {
      left: 100%;
    }

    #rollBtn:active {
      transform: translateY(1px);
    }

    #resultado-narrativo, #soma-total {
      text-align: center;
      font-size: 1.4rem;
      margin: 25px 0;
      font-weight: 600;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
    }

    .dice-container {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin: 30px 0;
    }

    .hex-dice {
      width: 130px;
      height: 115px;
      background: linear-gradient(145deg, #5dade2, #2980b9);
      clip-path: polygon(50% 0%, 93% 25%, 93% 75%, 50% 100%, 7% 75%, 7% 25%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      font-weight: bold;
      color: white;
      box-shadow: 0 0 20px rgba(41, 128, 185, 0.6);
      user-select: none;
      transition: all 0.3s ease;
      position: relative;
    }

    .hex-dice::before {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      right: 2px;
      bottom: 2px;
      clip-path: polygon(50% 0%, 93% 25%, 93% 75%, 50% 100%, 7% 75%, 7% 25%);
      background: transparent;
      z-index: 1;
    }

    .hex-dice.purple {
      background: linear-gradient(145deg, #a569bd, #8e44ad);
      box-shadow: 0 0 20px rgba(142, 68, 173, 0.6);
    }

    .hex-dice.gold {
      background: linear-gradient(145deg, #f7dc6f, #d4ac0d);
      color: #3e2e00;
      box-shadow: 0 0 20px rgba(212, 172, 13, 0.6);
    }

    .hex-dice.orange {
      background: linear-gradient(145deg, #ff9a3d, var(--secondary));
      color: #3e2e00;
      box-shadow: 0 0 20px rgba(255, 106, 0, 0.6);
    }

    #historySidebar {
      background: #222;
      color: white;
      padding: 20px;
      border-top: 3px solid var(--primary);
      max-height: 300px;
      overflow-y: auto;
      font-size: 0.9rem;
      margin-top: 30px;
      border-radius: 0 0 12px 12px;
      box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.4);
    }

    #historySidebar h2 {
      font-size: 1.2rem;
      margin-bottom: 15px;
      color: var(--primary);
      text-align: center;
      padding-bottom: 10px;
      border-bottom: 1px solid #444;
    }

    #historySidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    #historySidebar li {
      padding: 10px 0;
      border-bottom: 1px solid #444;
      transition: background 0.3s;
    }

    #historySidebar li:hover {
      background: rgba(46, 204, 113, 0.1);
    }

    #historySidebar li:last-child {
      border-bottom: none;
    }

    @keyframes rotateJump {
      0% { transform: translateY(0) scale(1) rotate(0deg); }
      40% { transform: translateY(-25px) scale(1.15) rotate(180deg); }
      100% { transform: translateY(0) scale(1) rotate(360deg); }
    }

    .rolling {
      animation: rotateJump 0.6s ease;
    }

    /* Ícones flutuantes */
    .float-icon {
      position: fixed;
      bottom: 30px;
      width: 70px;
      height: 70px;
      border-radius: 50%;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      z-index: 9999;
      border: 2px solid rgba(255, 255, 255, 0.1);
    }
    
    #diceIcon {
      right: 120px;
      background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
    }
    
    #diceIcon:hover {
      transform: translateY(-5px) scale(1.1);
      box-shadow: 0 10px 25px rgba(255, 106, 0, 0.6);
    }
    
    #notesIcon {
      right: 30px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    }
    
    #notesIcon:hover {
      transform: translateY(-5px) scale(1.1);
      box-shadow: 0 10px 25px rgba(46, 204, 113, 0.6);
    }
    
    .float-icon svg {
      fill: white;
      width: 32px;
      height: 32px;
      pointer-events: none;
    }

    /* Modal de dados comuns */
    #diceModal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: var(--card-bg);
      width: 90vw;
      max-width: 500px;
      height: 500px;
      border-radius: 18px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.8);
      color: white;
      display: flex;
      flex-direction: column;
      z-index: 10000;
      transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.4);
      overflow: hidden;
    }
    
    #diceModal.open {
      transform: translate(-50%, -50%) scale(1);
    }
    
    #diceModal header {
      padding: 18px 25px;
      background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
      border-radius: 18px 18px 0 0;
      font-size: 1.3rem;
      font-weight: 600;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    #diceModal header button.closeDice {
      background: transparent;
      border: none;
      font-size: 2rem;
      font-weight: bold;
      cursor: pointer;
      color: white;
      line-height: 1;
      padding: 0 8px;
      transition: transform 0.2s;
    }
    
    #diceModal header button.closeDice:hover {
      transform: rotate(90deg);
    }
    
    .dice-tabs {
      display: flex;
      background: #222;
      border-bottom: 3px solid var(--secondary);
    }
    
    .dice-tabs button {
      flex: 1;
      padding: 14px 0;
      background: none;
      border: none;
      color: var(--text-muted);
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.3s;
    }
    
    .dice-tabs button:hover {
      color: var(--secondary);
      background: rgba(255, 106, 0, 0.1);
    }
    
    .dice-tabs button.active {
      color: var(--secondary);
      border-bottom: 3px solid var(--secondary);
      background: rgba(255, 106, 0, 0.05);
      font-weight: 700;
    }
    
    .dice-tab-content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }
    
    .dice-controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 25px;
    }
    
    .dice-control-group {
      display: flex;
      flex-direction: column;
    }
    
    .dice-control-group label {
      margin-bottom: 8px;
      color: var(--secondary);
      font-weight: 500;
    }
    
    .dice-control-group select,
    .dice-control-group input {
      padding: 12px;
      border-radius: 10px;
      border: 2px solid transparent;
      background: var(--input-bg);
      color: white;
      font-size: 1rem;
      transition: all 0.3s;
    }
    
    .dice-control-group select:focus,
    .dice-control-group input:focus {
      border-color: var(--secondary);
      box-shadow: 0 0 0 3px rgba(255, 106, 0, 0.2);
      outline: none;
    }
    
    #rollAll {
      background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
      color: white;
      border: none;
      border-radius: 10px;
      padding: 14px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      margin-bottom: 25px;
      width: 100%;
      box-shadow: 0 4px 15px rgba(255, 106, 0, 0.3);
    }
    
    #rollAll:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255, 106, 0, 0.4);
    }
    
    #diceResults {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
      align-items: center;
      min-height: 150px;
      padding: 15px;
      background: rgba(0, 0, 0, 0.1);
      border-radius: 10px;
    }
    
    .dado-roll {
      width: 70px;
      height: 60px;
      background: linear-gradient(145deg, #ff9a3d, var(--secondary));
      clip-path: polygon(50% 0%, 93% 25%, 93% 75%, 50% 100%, 7% 75%, 7% 25%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      font-weight: bold;
      color: white;
      box-shadow: 0 0 15px rgba(255, 106, 0, 0.5);
      transition: transform 0.3s;
    }
    
    .dado-roll:hover {
      transform: scale(1.1);
    }
    
    .dice-history {
      padding: 15px;
    }
    
    .dice-history ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .dice-history li {
      padding: 10px 0;
      border-bottom: 1px solid #444;
      transition: background 0.3s;
    }
    
    .dice-history li:hover {
      background: rgba(255, 106, 0, 0.05);
    }
    
    .dice-history li:last-child {
      border-bottom: none;
    }

    /* Modal das Anotações */
    #notesModal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: var(--card-bg);
      width: 90vw;
      max-width: 750px;
      height: 500px;
      border-radius: 18px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.8);
      color: white;
      display: flex;
      flex-direction: column;
      z-index: 10000;
      transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.4);
      overflow: hidden;
    }

    #notesModal.open {
      transform: translate(-50%, -50%) scale(1);
    }

    #notesModal header {
      padding: 18px 25px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      border-radius: 18px 18px 0 0;
      font-size: 1.3rem;
      font-weight: 600;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #notesModal header button.closeBtn {
      background: transparent;
      border: none;
      font-size: 2rem;
      font-weight: bold;
      cursor: pointer;
      color: white;
      line-height: 1;
      padding: 0 8px;
      transition: transform 0.2s;
    }

    #notesModal header button.closeBtn:hover {
      transform: rotate(90deg);
    }

    .tabs {
      display: flex;
      background: #222;
      border-bottom: 3px solid var(--primary);
    }

    .tabs button {
      flex: 1;
      padding: 14px 0;
      background: none;
      border: none;
      color: var(--text-muted);
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.3s;
    }

    .tabs button:hover {
      color: var(--primary);
      background: rgba(46, 204, 113, 0.1);
    }

    .tabs button.active {
      color: var(--primary);
      border-bottom: 3px solid var(--primary);
      background: rgba(46, 204, 113, 0.05);
      font-weight: 700;
    }

    .tab-content {
      flex: 1;
      padding: 20px;
    }

    .tab-content textarea {
      width: 100%;
      height: 100%;
      background: var(--input-bg);
      border-radius: 12px;
      border: 2px solid transparent;
      padding: 15px;
      color: white;
      font-size: 1rem;
      font-family: 'Poppins', 'Segoe UI', sans-serif;
      resize: none;
      box-sizing: border-box;
      box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
      transition: all 0.3s;
    }

    .tab-content textarea:focus {
      background: #3a3a3a;
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.2), inset 0 0 10px rgba(0, 0, 0, 0.5);
    }

    #modalOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.7);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 9998;
      backdrop-filter: blur(5px);
    }

    #modalOverlay.active {
      opacity: 1;
      pointer-events: auto;
    }

    /* Scrollbar styling */
    #historySidebar::-webkit-scrollbar {
      width: 10px;
    }

    #historySidebar::-webkit-scrollbar-track {
      background: #1e1e1e;
      border-radius: 10px;
    }

    #historySidebar::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 10px;
    }
    
    .dice-tab-content::-webkit-scrollbar {
      width: 10px;
    }
    
    .dice-tab-content::-webkit-scrollbar-track {
      background: #1e1e1e;
      border-radius: 10px;
    }
    
    .dice-tab-content::-webkit-scrollbar-thumb {
      background: var(--secondary);
      border-radius: 10px;
    }

    /* Responsividade */
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      
      h1 {
        font-size: 1.8rem;
      }
      
      .section {
        padding: 18px;
      }
      
      .atributos-grid {
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      }
      
      .dice-container {
        flex-direction: column;
        align-items: center;
        gap: 20px;
      }
      
      .float-icon {
        width: 60px;
        height: 60px;
      }
      
      #diceIcon {
        right: 90px;
        bottom: 20px;
      }
      
      #notesIcon {
        right: 20px;
        bottom: 20px;
      }
    }
  </style>
</head>
<body>
  
  
  
  
  
  
 <script>
    // Função para salvar todos os dados nos atributos HTML
    function saveToHtmlAttributes() {
      // Salvar valores de todos os campos de texto/número
      document.querySelectorAll('input[type="text"], input[type="number"], textarea').forEach(input => {
        input.setAttribute('value', input.value);
      });
      
      // Salvar estado dos checkboxes
      document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        if (checkbox.checked) {
          checkbox.setAttribute('checked', 'checked');
        } else {
          checkbox.removeAttribute('checked');
        }
      });
      
      // Salvar conteúdo das textareas (especialmente nas abas)
      document.querySelectorAll('textarea').forEach(textarea => {
        textarea.textContent = textarea.value;
      });
    }

    // Função para salvar no localStorage (para uso na mesma sessão)
    function saveToLocalStorage() {
      const formData = {
        // [Seu código existente de coleta de dados]
      };
      localStorage.setItem('daggerheartCharacterSheet', JSON.stringify(formData));
    }

    // Função combinada de salvamento
    function saveAllData() {
      saveToHtmlAttributes();
      saveToLocalStorage();
    }

    // Configurar eventos de salvamento
    document.querySelectorAll('input, textarea').forEach(element => {
      element.addEventListener('input', saveAllData);
    });

    document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
      checkbox.addEventListener('change', saveAllData);
    });

    // Carregar dados quando a página é aberta
    window.addEventListener('load', function() {
      // Primeiro carregar do localStorage
      const savedData = localStorage.getItem('daggerheartCharacterSheet');
      if (savedData) {
        const formData = JSON.parse(savedData);
        // [Seu código existente de carregamento de dados]
      }
      
      // Depois garantir que os atributos HTML estão sincronizados
      document.querySelectorAll('input[type="text"], input[type="number"], textarea').forEach(input => {
        if (input.hasAttribute('value')) {
          input.value = input.getAttribute('value');
        }
      });
      
      document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        checkbox.checked = checkbox.hasAttribute('checked');
      });
      
      // Garantir que as textareas estão sincronizadas
      document.querySelectorAll('textarea').forEach(textarea => {
        if (textarea.textContent) {
          textarea.value = textarea.textContent;
        }
      });
    });

    // [O resto do seu JavaScript permanece igual]

//------------------------------------------------//
//////----------------------------------------------//
///////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  </script>
  <div class="container">
    <h1>Ficha de Personagem Daggerheart</h1>

    <div class="section">
      <h2>Informações Gerais</h2>
      <label>Nome</label><input type="text" placeholder="Nome do personagem">
      <label>Nível de classe</label><input type="text" min="1" placeholder="Nível">
    </div>

    <div class="section">
      <h2>Atributos</h2>
      <div class="atributos-grid">
        <input type="text" value="0">
        <input type="text" value="0">
        <input type="text" value="0">
        <input type="text" value="0">
        <input type="text" value="0">
        <input type="text" value="0">
      </div>
    </div>

    <div class="section">
      <h2>status</h2>
      <label>Pontos de Vida (HP)</label><input type="text" placeholder="HP">
      <label>Armadura</label><input type="text" placeholder="Armadura">
      <label>Evasao</label><input type="text" placeholder="Evasao">
      <label>Estresse</label><input type="text" placeholder="Estresse">
    </div>

    <div class="section">
      <h2>Experiências & Recursos de Classe</h2>
      <label>Experiências</label><textarea rows="2" placeholder="Experiências adquiridas..."></textarea>
      <label>Recursos de Classe</label><textarea rows="2" placeholder="Recursos especiais..."></textarea>
    </div>

    <div class="section">
      <h2>Fortuna</h2>
      <div class="checkbox-group">
        <label><input type="checkbox"> PUNHADO</label>
        <label><input type="checkbox"> BOLSAS</label>
        <label><input type="checkbox"> BAÚS</label>
        <label><input type="checkbox"> TESOURO</label>
        <label><input type="checkbox"> FORTUNA</label>
      </div>
    </div>

    <button id="rollBtn" onclick="rollDice()">🎲 Rolar Esperança e Medo 🎲</button>

    <div id="resultado-narrativo">Clique para rolar os dados</div>

    <div class="dice-container">
      <div id="esperanca" class="hex-dice">?</div>
      <div id="medo" class="hex-dice purple">?</div>
    </div>

    <div id="soma-total">Soma: ?</div>

    <div id="historySidebar">
      <h2>Histórico de Rolagens</h2>
      <ul id="historyList"></ul>
    </div>
  </div>
  
  <!-- Ícones flutuantes -->
  <div id="diceIcon" class="float-icon" title="Rolagem de Dados">
    <svg viewBox="0 0 24 24"><path d="M5 3h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2zm2 2a2 2 0 0 0-2 2 2 2 0 0 0 2 2 2 2 0 0 0 2-2 2 2 0 0 0-2-2zm10 10a2 2 0 0 0-2 2 2 2 0 0 0 2 2 2 2 0 0 0 2-2 2 2 0 0 0-2-2zm0-10a2 2 0 0 0-2 2 2 2 0 0 0 2 2 2 2 0 0 0 2-2 2 2 0 0 0-2-2zm-10 10a2 2 0 0 0-2 2 2 2 0 0 0 2 2 2 2 0 0 0 2-2 2 2 0 0 0-2-2zm5-5a2 2 0 0 0-2 2 2 2 0 0 0 2 2 2 2 0 0 0 2-2 2 2 0 0 0-2-2z"/></svg>
  </div>
  
  <div id="notesIcon" class="float-icon" title="Abrir Anotações">
    <svg viewBox="0 0 24 24"><path d="M6 2a2 2 0 0 0-2 2v16l4-4h10a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H6zM5 4a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v9H9l-4 4V4z"/></svg>
  </div>

  <!-- Modal de dados comuns -->
  <div id="diceModal" role="dialog" aria-modal="true" aria-labelledby="diceModalTitle">
    <header>
      <div id="diceModalTitle">Rolagem de Dados</div>
      <button class="closeDice" aria-label="Fechar">&times;</button>
    </header>

    <nav class="dice-tabs" role="tablist" aria-label="Abas de Dados">
      <button role="tab" id="diceTab1" aria-controls="diceTabContent1" aria-selected="true" class="active">Rolagem</button>
      <button role="tab" id="diceTab2" aria-controls="diceTabContent2" aria-selected="false">Histórico</button>
    </nav>

    <section id="diceTabContent1" class="dice-tab-content" role="tabpanel" aria-labelledby="diceTab1">
      <div class="dice-controls">
        <div class="dice-control-group">
          <label for="diceType">Tipo de Dado</label>
          <select id="diceType">
            <option value="4">d4</option>
            <option value="6">d6</option>
            <option value="8">d8</option>
            <option value="10">d10</option>
            <option value="12" selected>d12</option>
          </select>
        </div>
        <div class="dice-control-group">
          <label for="diceQty">Quantidade</label>
          <input type="number" id="diceQty" min="1" max="10" value="1">
        </div>
      </div>
      
      <button id="rollAll">Rolar Dados</button>
      
      <div id="diceResults">
        <!-- Resultados dos dados aparecerão aqui -->
      </div>
    </section>
    
    <section id="diceTabContent2" class="dice-tab-content" role="tabpanel" aria-labelledby="diceTab2" hidden>
      <div class="dice-history">
        <ul id="diceHistoryList"></ul>
      </div>
    </section>
  </div>

  <!-- Modal de anotações -->
  <div id="modalOverlay"></div>
  <div id="notesModal" role="dialog" aria-modal="true" aria-labelledby="notesModalTitle">
    <header>
      <div id="notesModalTitle">Anotações do Jogador</div>
      <button class="closeBtn" aria-label="Fechar Anotações">&times;</button>
    </header>

    <nav class="tabs" role="tablist" aria-label="Abas de Anotações">
      <button role="tab" id="tab1" aria-controls="tabContent1" aria-selected="true" class="active">Ideias</button>
      <button role="tab" id="tab2" aria-controls="tabContent2" aria-selected="false">Diário</button>
      <button role="tab" id="tab3" aria-controls="tabContent3" aria-selected="false">Inventário</button>
      <button role="tab" id="tab4" aria-controls="tabContent4" aria-selected="false">História do Jogador</button>
    </nav>

    <section id="tabContent1" class="tab-content" role="tabpanel" aria-labelledby="tab1">
      <textarea placeholder="Escreva suas ideias aqui..."></textarea>
    </section>
    <section id="tabContent2" class="tab-content" role="tabpanel" aria-labelledby="tab2" hidden>
      <textarea placeholder="Registre seu diário..."></textarea>
    </section>
    <section id="tabContent3" class="tab-content" role="tabpanel" aria-labelledby="tab3" hidden>
      <textarea placeholder="Liste seu inventário..."></textarea>
    </section>
    <section id="tabContent4" class="tab-content" role="tabpanel" aria-labelledby="tab4" hidden>
      <textarea placeholder="Descreva sua história..."></textarea>
    </section>
  </div>

  <script>
    // Funções para dados especiais (Esperança e Medo)
    function rollD12() {
      return Math.floor(Math.random() * 12) + 1;
    }

    const dadoEsperanca = document.getElementById('esperanca');
    const dadoMedo = document.getElementById('medo');
    const resultadoTexto = document.getElementById('resultado-narrativo');
    const somaTexto = document.getElementById('soma-total');
    const historyList = document.getElementById('historyList');
    const historicoRolagens = [];

    function atualizarHistorico() {
      historyList.innerHTML = '';
      for (let i = historicoRolagens.length - 1; i >= 0; i--) {
        const li = document.createElement('li');
        li.textContent = historicoRolagens[i];
        historyList.appendChild(li);
      }
    }

    function rodarDado(dado, valor) {
      return new Promise(resolve => {
        dado.classList.add('rolling');
        dado.textContent = '...';
        setTimeout(() => {
          dado.textContent = valor;
          dado.classList.remove('rolling');
          resolve();
        }, 600);
      });
    }

    async function rollDice() {
      dadoEsperanca.classList.remove('gold');
      dadoMedo.classList.remove('gold');
      resultadoTexto.style.color = '#2ecc71';

      const valorEsperanca = rollD12();
      await rodarDado(dadoEsperanca, valorEsperanca);

      await new Promise(r => setTimeout(r, 1000));

      const valorMedo = rollD12();
      await rodarDado(dadoMedo, valorMedo);

      const soma = valorEsperanca + valorMedo;
      somaTexto.textContent = `Soma: ${soma}`;

      const sucesso = valorEsperanca >= 1 || valorMedo >= 1;
      const dominante = (valorEsperanca > valorMedo) ? 'esperanca' :
                        (valorMedo > valorEsperanca) ? 'medo' :
                        (Math.random() < 0.5 ? 'esperanca' : 'medo');

      if (valorEsperanca === 12 && valorMedo === 12) {
        resultadoTexto.innerHTML = '✨ SUCESSO CRÍTICO! ✨';
        dadoEsperanca.classList.add('gold');
        dadoMedo.classList.add('gold');
      } else if (valorEsperanca === 1 && valorMedo === 1) {
        resultadoTexto.innerHTML = '💀 FALHA CRÍTICA! 💀';
      } else if (sucesso) {
        resultadoTexto.innerHTML = dominante === 'esperanca'
          ? 'Esperança🔵 '
          : 'Medo🟣';
     } 

      const hora = new Date().toLocaleTimeString();
      historicoRolagens.push(`[${hora}] Esperança: ${valorEsperanca}, Medo: ${valorMedo}, Soma: ${soma}`);
      atualizarHistorico();
    }

    // Modal: notas
    const notesIcon = document.getElementById('notesIcon');
    const notesModal = document.getElementById('notesModal');
    const modalOverlay = document.getElementById('modalOverlay');
    const closeBtn = notesModal.querySelector('.closeBtn');
    const tabs = notesModal.querySelectorAll('.tabs button');
    const contents = notesModal.querySelectorAll('.tab-content');

    notesIcon.onclick = () => {
      notesModal.classList.add('open');
      modalOverlay.classList.add('active');
    };

    closeBtn.onclick = () => {
      notesModal.classList.remove('open');
      modalOverlay.classList.remove('active');
    };

    // Modal: dados comuns
    const diceIcon = document.getElementById('diceIcon');
    const diceModal = document.getElementById('diceModal');
    const diceClose = diceModal.querySelector('.closeDice');
    const diceTabs = diceModal.querySelectorAll('.dice-tabs button');
    const diceContents = diceModal.querySelectorAll('.dice-tab-content');
    const diceType = document.getElementById('diceType');
    const diceQty = document.getElementById('diceQty');
    const rollAllBtn = document.getElementById('rollAll');
    const diceResultArea = document.getElementById('diceResults');
    const diceHistoryList = document.getElementById('diceHistoryList');
    const diceHistory = [];

    diceIcon.onclick = () => {
      diceModal.classList.add('open');
      modalOverlay.classList.add('active');
    };

    diceClose.onclick = () => {
      diceModal.classList.remove('open');
      modalOverlay.classList.remove('active');
    };

    // Rolagem de dados comuns
    rollAllBtn.onclick = async () => {
      const tipo = parseInt(diceType.value);
      const qtd = parseInt(diceQty.value);
      diceResultArea.innerHTML = '';
      let total = 0;
      const rolls = [];

      for (let i = 0; i < qtd; i++) {
        const val = Math.floor(Math.random() * tipo) + 1;
        total += val;
        rolls.push(val);
        
        const span = document.createElement('div');
        span.className = 'dado-roll';
        span.textContent = '🎲';
        diceResultArea.appendChild(span);

        await new Promise(r => setTimeout(r, 300));
        span.textContent = val;
      }

      if (qtd > 1) {
        const totalSpan = document.createElement('div');
        totalSpan.style.width = '100%';
        totalSpan.style.textAlign = 'center';
        totalSpan.style.marginTop = '15px';
        totalSpan.style.fontSize = '18px';
        totalSpan.style.fontWeight = 'bold';
        totalSpan.innerHTML = `Soma: ${total}`;
        diceResultArea.appendChild(totalSpan);
      }

      // Adicionar ao histórico
      const hora = new Date().toLocaleTimeString();
      const diceTypeText = `d${tipo}`;
      const rollText = rolls.join(' + ');
      const historyEntry = `[${hora}] ${qtd}${diceTypeText}: ${rollText} = ${total}`;
      diceHistory.unshift(historyEntry);
      
      // Atualizar histórico
      diceHistoryList.innerHTML = '';
      diceHistory.forEach(entry => {
        const li = document.createElement('li');
        li.textContent = entry;
        diceHistoryList.appendChild(li);
      });
    };

    // Abas para dados comuns
    diceTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        diceTabs.forEach(t => {
          t.classList.remove('active');
          t.setAttribute('aria-selected', 'false');
        });
        tab.classList.add('active');
        tab.setAttribute('aria-selected', 'true');

        diceContents.forEach(c => c.hidden = true);
        const content = document.getElementById(tab.getAttribute('aria-controls'));
        if (content) content.hidden = false;
      });
    });

    // Abas para anotações
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => {
          t.classList.remove('active');
          t.setAttribute('aria-selected', 'false');
        });
        tab.classList.add('active');
        tab.setAttribute('aria-selected', 'true');

        contents.forEach(c => c.hidden = true);
        const content = document.getElementById(tab.getAttribute('aria-controls'));
        if (content) content.hidden = false;
      });
    });

    // Fechar modais ao clicar fora
    modalOverlay.onclick = () => {
      notesModal.classList.remove('open');
      diceModal.classList.remove('open');
      modalOverlay.classList.remove('active');
    };
  </script>
</body>
</html>
